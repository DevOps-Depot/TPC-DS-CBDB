-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
     (SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '89771','11554','27903','73658','58360','82395',
                          '11172','35116','83154','28169','70520',
                          '62185','19606','94388','28564','86492',
                          '59079','51603','79696','21742','52760',
                          '33258','46996','97809','61523','56121',
                          '48476','94856','97735','11148','68631',
                          '20486','45556','36463','54974','21136',
                          '59437','14604','91308','76474','76315',
                          '62006','40485','92437','38599','88778',
                          '46740','53095','95670','31156','76929',
                          '53849','53012','57530','13813','89168',
                          '15975','31060','40286','56129','98377',
                          '13791','10809','76528','48657','79405',
                          '85024','85237','32905','11053','70435',
                          '47799','13157','13740','69677','62362',
                          '42598','33835','86388','23990','12224',
                          '65528','49108','31937','12133','42321',
                          '73445','72525','50706','90730','51919',
                          '66247','22400','37923','56952','31367',
                          '61094','12417','40701','38501','61006',
                          '26455','57742','47268','18683','70587',
                          '55083','65245','52799','72982','95484',
                          '46479','76668','25271','50635','65152',
                          '20838','41104','10369','96425','97622',
                          '96175','47987','51294','25575','20036',
                          '27891','53575','83526','45818','45789',
                          '42039','42191','97756','15561','22508',
                          '73566','16358','58710','64587','36329',
                          '30910','31626','76757','43583','58771',
                          '14957','94414','92837','99167','43143',
                          '56560','81878','31583','44681','74817',
                          '61801','22896','17209','39565','91611',
                          '92146','46607','44209','11690','87716',
                          '58700','57605','35000','68230','50725',
                          '15441','23365','71074','19312','61069',
                          '87600','69659','25403','91253','20998',
                          '47648','91715','88327','70693','68547',
                          '28541','44417','24756','36144','33677',
                          '52690','41317','28939','47662','23246',
                          '25789','58450','99043','43086','42107',
                          '42955','80243','35609','87192','19059',
                          '43121','60631','77483','85828','12065',
                          '43304','50184','52740','47279','99142',
                          '95704','83147','20964','25007','79856',
                          '74178','53578','27112','89032','92456',
                          '58754','86362','54638','56317','84578',
                          '68714','10186','65327','44424','74375',
                          '87162','55939','13621','17299','31627',
                          '97132','42543','42143','31410','30905',
                          '57056','57274','57643','48050','46550',
                          '91239','14362','16010','68064','11988',
                          '76256','23842','95004','87341','88536',
                          '80304','56711','69464','35337','49769',
                          '46595','80152','21054','26306','44689',
                          '49647','57737','47735','29019','40610',
                          '94064','57025','29280','52809','58228',
                          '75474','68956','42284','38667','50775',
                          '81190','76966','20585','67394','63797',
                          '10606','11383','27629','93733','47023',
                          '26505','89999','86768','66733','52978',
                          '62464','63958','29176','53999','41785',
                          '25304','88907','34501','83326','74499',
                          '51049','16009','20466','45513','43575',
                          '52685','68309','26020','50237','77346',
                          '28549','88801','56181','20084','72048',
                          '89245','16839','41946','23898','20722',
                          '29817','83458','48664','18824','22277',
                          '20207','66613','31940','20977','41618',
                          '83976','23569','45134','70841','68544',
                          '49615','57759','40931','55837','81926',
                          '33058','69180','67726','82285','45846',
                          '17072','37432','19518','82489','89496',
                          '24841','29048','25443','46722','83559',
                          '62710','60828','10184','37837','51584',
                          '89975','74382','69187','74180','56741',
                          '68754','22660','74910','18390','60158',
                          '13799','31922','73637','46559','11794',
                          '35372','44398','77932','17668','30107',
                          '34033','78231','21418','51807','13229',
                          '76363','91398','29215','18068'))
     intersect
     (select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1))A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 63 in stream 0 using template query8.tpl
