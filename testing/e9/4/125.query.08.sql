-- start query 25 in stream 3 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
     (SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76008','30077','42535','49570','72277','67365',
                          '43987','91141','35040','28343','70002',
                          '22146','35925','87593','24608','70299',
                          '23967','90553','68742','40651','88930',
                          '99216','10959','76398','70931','16008',
                          '19979','28650','52864','42516','93429',
                          '96273','85600','52148','82719','62869',
                          '15530','44310','99953','47253','79451',
                          '51375','58842','34641','36128','57228',
                          '34393','71510','57731','21017','21006',
                          '48390','33973','59862','76747','94670',
                          '60539','49160','47654','46802','86892',
                          '45115','53840','52035','69755','20282',
                          '14622','47986','41805','76833','60108',
                          '52271','51364','17768','81654','80745',
                          '45811','62012','19715','19221','13088',
                          '46900','86593','80645','62201','38555',
                          '56584','10270','82478','91180','47473',
                          '60604','69801','27647','31500','43203',
                          '33823','51773','41981','10181','33494',
                          '38738','96534','12003','35848','59508',
                          '79626','77835','22478','29332','86506',
                          '54272','83696','77161','42688','75195',
                          '44569','87803','97881','40896','17643',
                          '86671','90267','98078','89944','92399',
                          '56392','75394','13672','34640','84657',
                          '72787','81437','79162','62504','44620',
                          '22047','56744','91733','63922','52549',
                          '80138','65241','71937','61813','18013',
                          '90151','87429','86908','92142','95207',
                          '26582','17296','63831','15883','22949',
                          '20593','13078','81990','50695','85331',
                          '93377','85192','16161','94957','70544',
                          '40882','26356','19938','13191','34711',
                          '93494','93910','23203','55810','25755',
                          '84050','29326','16729','75247','66668',
                          '46417','86179','26447','86491','99028',
                          '28435','73514','86280','49243','49840',
                          '50381','25267','88870','59271','16401',
                          '72017','31089','51338','98395','31078',
                          '65406','55567','62443','15067','44881',
                          '32944','77733','88282','44387','14123',
                          '40825','62093','79467','99319','79455',
                          '56175','30775','18648','23248','52929',
                          '32191','55091','17029','21206','82290',
                          '36258','19697','65687','93990','54289',
                          '99386','79720','13972','71217','10609',
                          '89001','83946','14114','66953','27658',
                          '54492','48901','51202','69179','65130',
                          '24021','58361','68580','78752','66648',
                          '57901','23014','67299','31574','29790',
                          '25372','67183','55914','40876','36455',
                          '69625','97535','34605','86236','22676',
                          '96269','17365','27329','56640','64944',
                          '21904','19761','51283','93170','53298',
                          '85659','61464','12390','31656','91619',
                          '89590','76147','78462','89489','91973',
                          '52670','61841','25258','73625','71035',
                          '92144','97079','76643','21887','21306',
                          '61375','38627','16424','86163','78942',
                          '99868','79212','48079','70664','62878',
                          '36226','90002','63876','55868','88827',
                          '74349','99929','43358','89082','88021',
                          '28440','94358','14238','59615','36778',
                          '96171','45737','60109','22268','16511',
                          '88701','30107','42093','30948','62523',
                          '45922','83120','36716','91501','64580',
                          '42439','48020','60987','47205','87998',
                          '69064','33332','59034','45295','40556',
                          '82446','70850','35618','95594','15175',
                          '64049','38866','64721','67253','42433',
                          '51820','77480','45498','88043','32771',
                          '96580','50616','63734','41852','72784',
                          '76343','71575','33927','18652','74435',
                          '31128','61666','88895','60694','69561',
                          '96468','96730','79549','32264','92257',
                          '30574','22476','14521','94291','79538',
                          '52876','67224','84956','15407','23823',
                          '99507','25491','82458','90176','95228',
                          '44590','22204','36245','91095'))
     intersect
     (select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1))A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 25 in stream 3 using template query8.tpl
